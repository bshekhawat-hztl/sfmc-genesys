<!DOCTYPE html>
<html>
<head>
  <title>Genesys WhatsApp Trigger</title>
  <meta charset="UTF-8" />
  <script src="https://apps.sfmc-content.com/legacy/jbActivity.js"></script>
</head>
<body>
  <h2>Genesys WhatsApp Trigger</h2>
  <label for="to">Phone Number:</label>
  <input type="text" id="to" placeholder="+971XXXXXXXXX" />
  <br /><br />
  <label for="message">Message:</label>
  <textarea id="message" placeholder="Enter your message"></textarea>
  <br /><br />
  <script>
    (function () {
      const connection = new CustomEvent("ready", {
        detail: {
          name: "Genesys WhatsApp Trigger"
        }
      });

      window.dispatchEvent(connection);

      window.addEventListener("initActivity", function (event) {
        const data = event.detail;
        const inArgs = data?.inArguments || [];
        document.getElementById("to").value = inArgs.find(arg => arg.to)?.to || "";
        document.getElementById("message").value = inArgs.find(arg => arg.message)?.message || "";
      });

      window.addEventListener("clickedNext", function () {
        const to = document.getElementById("to").value;
        const message = document.getElementById("message").value;

        if (!to || !message) {
          alert("Please provide both phone number and message.");
          return;
        }

        window.parent.postMessage(
          JSON.stringify({
            action: "updateActivity",
            arguments: {
              execute: {
                inArguments: [
                  { to },
                  { message }
                ],
                outArguments: []
              }
            }
          }),
          "*"
        );
      });
    })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Genesys WhatsApp Trigger</title>
  <script src="https://apps.contentassets.exacttarget.com/legacy/jbActivity.js"></script>
</head>
<body>
  <h1>Genesys WhatsApp Trigger</h1>

  <label for="phone">Phone Number:</label>
  <input type="text" id="phone" placeholder="+971xxxxxxxxx"><br>

  <label for="message">Message:</label>
  <textarea id="message" placeholder="Type your message here"></textarea>

  <script>
    var payload = {};

    // Called by Journey Builder when activity is initialized
    function initialize(data) {
      console.log('Activity initialized:', data);

      if (data) {
        payload = data;

        // Pre-fill if config was already saved
        const phone = data.arguments?.execute?.inArguments?.find(arg => arg.to)?.to || '';
        const message = data.arguments?.execute?.inArguments?.find(arg => arg.message)?.message || '';

        document.getElementById("phone").value = phone;
        document.getElementById("message").value = message;
      }
    }

    // Called when user clicks "Done"
    function save() {
      const phone = document.getElementById("phone").value;
      const message = document.getElementById("message").value;

      payload.arguments.execute.inArguments = [
        { to: phone },
        { message: message }
      ];
      payload.metaData.isConfigured = true;

      console.log('Saving payload:', payload);
      // Sends payload back to Journey Builder
      connection.trigger('updateActivity', payload);
    }

    // Listen for Journey Builder events
    connection.on('initActivity', initialize);
    connection.on('requestedTokens', function() {});
    connection.on('requestedEndpoints', function() {});
    connection.on('clickedNext', save);
  </script>
</body>
</html>
